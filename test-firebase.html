<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Connection Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-box {
            background: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
            margin-left: 10px;
        }
        .success {
            background: #10b981;
            color: white;
        }
        .error {
            background: #ef4444;
            color: white;
        }
        .pending {
            background: #fbbf24;
            color: black;
        }
        pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 12px;
        }
        button {
            background: #4f46e5;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background: #4338ca;
        }
        h1 {
            color: #1e293b;
        }
        h3 {
            color: #475569;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>ğŸ”¥ Firebase Connection Test</h1>
    <p>ì´ í˜ì´ì§€ëŠ” Firebase Firestore ì—°ê²°ê³¼ ê¶Œí•œì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>

    <div class="test-box">
        <h3>1. Firebase SDK ë¡œë“œ</h3>
        <span id="sdk-status" class="status pending">í…ŒìŠ¤íŠ¸ ì¤‘...</span>
        <pre id="sdk-info"></pre>
    </div>

    <div class="test-box">
        <h3>2. Firestore ì´ˆê¸°í™”</h3>
        <span id="firestore-status" class="status pending">í…ŒìŠ¤íŠ¸ ì¤‘...</span>
        <pre id="firestore-info"></pre>
    </div>

    <div class="test-box">
        <h3>3. Shifts ì»¬ë ‰ì…˜ ì½ê¸° ê¶Œí•œ</h3>
        <span id="read-status" class="status pending">ëŒ€ê¸° ì¤‘</span>
        <button onclick="testRead()">ì½ê¸° í…ŒìŠ¤íŠ¸</button>
        <pre id="read-info"></pre>
    </div>

    <div class="test-box">
        <h3>4. Shifts ì»¬ë ‰ì…˜ ì“°ê¸° ê¶Œí•œ</h3>
        <span id="write-status" class="status pending">ëŒ€ê¸° ì¤‘</span>
        <button onclick="testWrite()">ì“°ê¸° í…ŒìŠ¤íŠ¸</button>
        <pre id="write-info"></pre>
    </div>

    <div class="test-box">
        <h3>5. ì „ì²´ í…ŒìŠ¤íŠ¸</h3>
        <button onclick="runAllTests()">ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>
    <script src="js/firebase-config.js"></script>

    <script>
        // Test 1: SDK Load
        function testSDK() {
            const sdkStatus = document.getElementById('sdk-status');
            const sdkInfo = document.getElementById('sdk-info');
            
            if (typeof firebase !== 'undefined') {
                sdkStatus.className = 'status success';
                sdkStatus.textContent = 'âœ… ì„±ê³µ';
                sdkInfo.textContent = `Firebase SDK ë²„ì „: ${firebase.SDK_VERSION || 'Unknown'}`;
            } else {
                sdkStatus.className = 'status error';
                sdkStatus.textContent = 'âŒ ì‹¤íŒ¨';
                sdkInfo.textContent = 'Firebase SDKê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.';
            }
        }

        // Test 2: Firestore Init
        function testFirestore() {
            const firestoreStatus = document.getElementById('firestore-status');
            const firestoreInfo = document.getElementById('firestore-info');
            
            try {
                if (typeof db !== 'undefined' && db) {
                    firestoreStatus.className = 'status success';
                    firestoreStatus.textContent = 'âœ… ì„±ê³µ';
                    firestoreInfo.textContent = 'Firestore ì´ˆê¸°í™” ì™„ë£Œ\ní”„ë¡œì íŠ¸: maruschedule-ccf5a';
                } else {
                    firestoreStatus.className = 'status error';
                    firestoreStatus.textContent = 'âŒ ì‹¤íŒ¨';
                    firestoreInfo.textContent = 'Firestoreê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.';
                }
            } catch (error) {
                firestoreStatus.className = 'status error';
                firestoreStatus.textContent = 'âŒ ì‹¤íŒ¨';
                firestoreInfo.textContent = 'Error: ' + error.message;
            }
        }

        // Test 3: Read Permission
        async function testRead() {
            const readStatus = document.getElementById('read-status');
            const readInfo = document.getElementById('read-info');
            
            readStatus.className = 'status pending';
            readStatus.textContent = 'í…ŒìŠ¤íŠ¸ ì¤‘...';
            readInfo.textContent = 'ì½ê¸° ê¶Œí•œ í™•ì¸ ì¤‘...';
            
            try {
                const snapshot = await db.collection('shifts').limit(1).get();
                readStatus.className = 'status success';
                readStatus.textContent = 'âœ… ì„±ê³µ';
                readInfo.textContent = `ì½ê¸° ê¶Œí•œ í™•ì¸ ì™„ë£Œ\në¬¸ì„œ ìˆ˜: ${snapshot.size}\nì½ê¸° ì‘ì—… ì„±ê³µ!`;
            } catch (error) {
                readStatus.className = 'status error';
                readStatus.textContent = 'âŒ ì‹¤íŒ¨';
                readInfo.textContent = `ì—ëŸ¬ ì½”ë“œ: ${error.code}\nì—ëŸ¬ ë©”ì‹œì§€: ${error.message}`;
            }
        }

        // Test 4: Write Permission
        async function testWrite() {
            const writeStatus = document.getElementById('write-status');
            const writeInfo = document.getElementById('write-info');
            
            writeStatus.className = 'status pending';
            writeStatus.textContent = 'í…ŒìŠ¤íŠ¸ ì¤‘...';
            writeInfo.textContent = 'ì“°ê¸° ê¶Œí•œ í™•ì¸ ì¤‘...';
            
            try {
                const testData = {
                    test: true,
                    user_id: 'test_user',
                    week_start: '2025-12-01',
                    day_key: 'mon',
                    created_at: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                const docRef = await db.collection('shifts').add(testData);
                
                // Delete test document
                await docRef.delete();
                
                writeStatus.className = 'status success';
                writeStatus.textContent = 'âœ… ì„±ê³µ';
                writeInfo.textContent = `ì“°ê¸° ê¶Œí•œ í™•ì¸ ì™„ë£Œ\ní…ŒìŠ¤íŠ¸ ë¬¸ì„œ ID: ${docRef.id}\nì“°ê¸° ì‘ì—… ì„±ê³µ! (í…ŒìŠ¤íŠ¸ ë¬¸ì„œëŠ” ìë™ ì‚­ì œë¨)`;
            } catch (error) {
                writeStatus.className = 'status error';
                writeStatus.textContent = 'âŒ ì‹¤íŒ¨';
                writeInfo.textContent = `ì—ëŸ¬ ì½”ë“œ: ${error.code}\nì—ëŸ¬ ë©”ì‹œì§€: ${error.message}`;
            }
        }

        // Run all tests
        async function runAllTests() {
            testSDK();
            testFirestore();
            await testRead();
            await testWrite();
        }

        // Auto run initial tests
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                testSDK();
                testFirestore();
            }, 1000);
        });
    </script>
</body>
</html>
